<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì‰½ë‹¤ì‰¬ì›Œ! ìš”ë¦¬ì™• - ì±—ë´‡ ë°ëª¨</title>
</head>
<body>
  <h2>ğŸ³ ì‰½ë‹¤ì‰¬ì›Œ! ìš”ë¦¬ì™• - í˜¼ë°¥ì¡±ì„ ìœ„í•œ í•¸ì¦ˆí”„ë¦¬ ìš”ë¦¬ ë„ìš°ë¯¸</h2>

  <!-- DialogFlow ì±—ë´‡ ì‚½ì… -->
  <script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
  <df-messenger
    intent="WELCOME"
    chat-title="ì‰½ë‹¤ì‰¬ì›Œ!ìš”ë¦¬ì™•"
    agent-id="fd70106c-4863-4636-ab90-13920c96c85c"
    language-code="ko"
  ></df-messenger>

  <!-- ìŒì„± ì…ë ¥ ë²„íŠ¼ ì¶”ê°€ -->
  <script>
    const observer = new MutationObserver(() => {
      const input = document.querySelector('df-messenger').shadowRoot
                      .querySelector('df-messenger-chat')
                      .shadowRoot.querySelector('input');

      if (input && !document.getElementById('mic-button')) {
        const btn = document.createElement('button');
        btn.id = 'mic-button';
        btn.innerText = 'ğŸ¤';
        btn.style.marginLeft = '10px';

        const recognition = new webkitSpeechRecognition();
        recognition.lang = 'ko-KR';

        btn.onclick = () => {
          recognition.start();
        };

        recognition.onresult = (event) => {
          const speech = event.results[0][0].transcript;
          input.value = speech;
          input.dispatchEvent(new KeyboardEvent('keydown', {key: 'Enter'}));
        };

        input.parentNode.appendChild(btn);
      }
    });

    observer.observe(document.body, { childList: true, subtree: true });
  </script>
</body>
</html>
